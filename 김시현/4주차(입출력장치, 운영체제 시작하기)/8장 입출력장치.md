# 8장 입출력 장치

### 8-1 장치 컨트롤러와 장치 드라이버

##### 장치 컨트롤러

장치 컨트롤러는 다루기 어렵다

이유 

   1. 입출력장치에는 종류가 너무나도 많다. 

2. 보통 CPU와 메모리의 데이터 전송률은 높지만 입출력장치의 데이터 전송률은 낮다.

그래서 장치 컨트롤러라는 하드웨어에 의해 CPU와 입출력장치가 연결된다.

장치 컨트롤러 기능

1. 종류가 많은 것을 장치 컨트롤러가 번역가 역할로 해결해줌

2. 그 과정에서 오류가 있는지도 체크

3. 데이터 버퍼링 문제를 해결(전송률 차이 문제 해결)

장치 컨트롤러의 구조

1. 데이터 레지스터 : CPU와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터

2. 상태 레지스터 : 입출력 작업을 할 준비가 됐는지, 완료됐는지, 오류 없는지 상태를 저장

3. 제어 레지스터 : 입출력장치가 수행할 내용에 대한 제어 정보와 명령을 저장

##### 장치 드라이버

장치 컨트롤러가 하드웨어적으로 CPU와 입출력장치를 연결해주는 것이었다면

장치 드라이버는 그러한 하드웨어 길들을 소프트웨어적으로 연결해주는 것이다.

참고로 장치드라이버를 인식하고 실행하는 주체는 운영체제이다.

기본적으로 운영체제는 여러 드라이버들을 가지고 있지만 없다면 직접 설치를 해야한다.

### 8-2 다양한 입출력 방법

##### 프로그램 입출력

메모리에 저장된 정보를 하드 디스크에 백업하는 상황

1. CPU는 컨트롤러에 제어 레지스터에 쓰기 명령

2. 하드디스크 상태 확인 (상태 레지스터 확인)

3. 백업할 메모리의 정보를 데이터 레지스터에 쓴다.

###### CPU가 여러 장치 컨트롤러 속 레지스터들을 모두 알기란 어려운데 어떻게 아는 걸까?

1. 메모리 맵 입출력
   
   메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법
   
   메모리 맵 입출력 방식에서 CPU는 메모리의 주소들이나 장치 컨트롤러의 레지스터들이나 모두 똑같이 메모리 주소를 대하듯 하면 된다는 점입니다. 그래서 메모리에 접근하는 명령어와 입출력장치에 접근하는 명령어는 굳이 다를 필요가 없다.

2. 고립형 입출력

        메모리를 위한 주소공간과 입출력장치를 위한 주소 공간을 분리하는 방법

        제어버스를 활용하여 메모리에 접근하고 입출력장치가 실행된다.

##### 인터럽트 기반 입출력

장치 컨트롤러가 보내는 인터럽트에 의해 인터럽트 서비스 루틴을 실행하는 방식

하지만 여러 장치 컨트롤러가 동시에 인터럽트를 발생시킬 때 문제가 발생한다.

이럴 때 PIC를 사용한다.

PIC는 여러 인터럽트를 처리하여 우선순위를 매겨 CPU로 인터럽트 우선순위가 높은 것을 전달한다.

##### DMA 입출력

Direct Memory Access란 이름 그대로 직접 메모리에 접근할 수 있는 입출력 기능이다.

DMA 입출력 과정

1. CPU는 DMA 컨트롤러에 입출력장치의 주소, 수행할 연산, 읽거나 쓸 메모리의 주소 등과 같은 정보로 입출력 작업을 명령합니다.

2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행합니다. 이때 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하여 정보를 읽거나 씁니다.

3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어 작업이 끝났음을 알립니다.

이럴 경우 DMA컨트롤러가 시스템버스에 2번 접근하여 CPU가 시스템 버스에 접근하지 못하는 병목현상이 발생할 수도 있다.

그래서 우리는 입출력 버스를 따로 만들어서 메모리에 1번만 접근하도록 하여 효율적으로 서로 버스를 사용하도록 설계하였다.

입출력 버스에는 PCI버스 PCI Express 버스 등이 있다.
